// Show/hide sections
function showSection(sectionId) {
    document.querySelectorAll('.section').forEach(section => {
      section.style.display = 'none';
    });
    document.getElementById(sectionId).style.display = 'block';
}

// Bot testing functionality
async function testBot() {
    const token = document.getElementById('bot-token').value;
    const command = document.getElementById('test-command').value;
    
    if (!token || !command) {
        alert('Please enter both token and command');
        return;
    }

try {
     const Discord = require('discord.js');
        const client = new Discord.Client({
         intents: [
        Discord.GatewayIntentBits.Guilds,
       Discord.GatewayIntentBits.GuildMessages
    ]
        });

        await client.login(token);
        console.log('Bot logged in successfully!');
     
        // Add event listeners for basic functionality
  client.on('ready', () => {
     alert(`Bot logged in as ${client.user.tag}`);
  });

        client.on('messageCreate', message => {
     if (message.content === command) {
  message.reply('Command received and working!');
            }
 });
    } catch (error) {
        alert('Error testing bot: ' + error.message);
    }
}

// Webhook manager functionality with enhanced features
async function sendWebhook() {
    const webhookUrl = document.getElementById('webhook-url').value;
 const message = document.getElementById('webhook-message').value;
    const embedColor = document.getElementById('embed-color').value;
  const embedTitle = document.getElementById('embed-title').value;

    try {
        const payload = {
  content: message,
            embeds: []
        };

        if (embedTitle) {
            payload.embeds.push({
       title: embedTitle,
                color: parseInt(embedColor.replace('#', ''), 16),
   timestamp: new Date().toISOString()
            });
   }

        const response = await fetch(webhookUrl, {
         method: 'POST',
   headers: {
 'Content-Type': 'application/json',
            },
     body: JSON.stringify(payload)
        });

      if (response.ok) {
 alert('Message sent successfully!');
        } else {
       const error = await response.text();
        alert('Failed to send message: ' + error);
        }
} catch (error) {
 alert('Error sending message: ' + error.message);
    }
}

// Token validator functionality with detailed analysis
function validateToken() {
    const token = document.getElementById('token-input').value;
    
    if (!token) {
        alert('Please enter a token');
        return;
    }

    try {
    const tokenParts = token.split('.');
  if (tokenParts.length !== 3) {
    alert('Invalid token format - Discord tokens should have 3 parts');
    return;
        }

      const payload = JSON.parse(atob(tokenParts[1]));
      const details = {
  id: payload.id || 'Unknown',
         type: getTokenType(payload),
        createdAt: payload.iat ? new Date(payload.iat * 1000).toLocaleString() : 'Unknown',
 expiresAt: payload.exp ? new Date(payload.exp * 1000).toLocaleString() : 'Never'
        };

        document.getElementById('token-analysis').innerHTML = `
   <h3>Token Analysis:</h3>
          <p>Token Type: ${details.type}</p>
  <p>Application ID: ${details.id}</p>
          <p>Created: ${details.createdAt}</p>
            <p>Expires: ${details.expiresAt}</p>
   `;
    } catch (e) {
 alert('Invalid token: Could not decode payload');
    }
}

function getTokenType(payload) {
    if (payload.bot) return 'Bot Token';
    if (payload.webhook) return 'Webhook Token';
    return 'User Token';
}

// Enhanced permissions calculator with role management
const DISCORD_PERMISSIONS = {
    'Administrator': 0x8,
    'Manage Server': 0x20,
    'Manage Roles': 0x10000000,
    'Manage Channels': 0x10,
    'Kick Members': 0x2,
    'Ban Members': 0x4,
    'Create Instant Invite': 0x1,
    'Change Nickname': 0x4000000,
    'Manage Nicknames': 0x8000000,
    'Manage Emojis': 0x40000000,
    'Manage Webhooks': 0x20000000,
    'View Channels': 0x400,
    'Send Messages': 0x800,
    'Send TTS Messages': 0x1000,
    'Manage Messages': 0x2000,
    'Embed Links': 0x4000,
    'Attach Files': 0x8000,
    'Read Message History': 0x10000,
    'Mention Everyone': 0x20000,
    'Use External Emojis': 0x40000,
    'Add Reactions': 0x40,
    'View Audit Log': 0x80,
    'Priority Speaker': 0x100,
    'Stream': 0x200,
    'View Guild Insights': 0x80000,
    'Connect': 0x100000,
    'Speak': 0x200000,
    'Mute Members': 0x400000,
    'Deafen Members': 0x800000,
    'Move Members': 0x1000000,
    'Use VAD': 0x2000000
};

// Initialize permissions calculator with preset templates
window.addEventListener('DOMContentLoaded', () => {
    const permissionsList = document.querySelector('.permissions-list');
    
    // Add permission checkboxes
    Object.entries(DISCORD_PERMISSIONS).forEach(([perm, value]) => {
    const div = document.createElement('div');
        div.innerHTML = `
            <label class="permission-label">
     <input type="checkbox" value="${value}" onchange="calculatePermissions()">
        ${perm}
       </label>
        `;
        permissionsList.appendChild(div);
    });

// Add preset templates
    const templates = {
        'Admin': ['Administrator'],
 'Moderator': ['Manage Messages', 'Kick Members', 'Ban Members', 'View Audit Log'],
        'Helper': ['View Channels', 'Send Messages', 'Read Message History', 'Add Reactions']
 };

    const templateSelect = document.getElementById('permission-template');
    Object.keys(templates).forEach(template => {
   const option = document.createElement('option');
        option.value = template;
        option.textContent = template;
        templateSelect.appendChild(option);
    });

    // Template change handler
    templateSelect.addEventListener('change', () => {
        const selected = templates[templateSelect.value] || [];
        document.querySelectorAll('.permissions-list input[type="checkbox"]').forEach(checkbox => {
     checkbox.checked = selected.includes(checkbox.parentElement.textContent.trim());
     });
        calculatePermissions();
  });
});

function calculatePermissions() {
    const checkboxes = document.querySelectorAll('.permissions-list input[type="checkbox"]');
    let total = 0n;
    
    checkboxes.forEach(checkbox => {
    if (checkbox.checked) {
         total += BigInt(checkbox.value);
        }
    });
    
    const result = document.getElementById('permission-integer');
    result.textContent = total.toString();
    
    // Add copy button functionality
    const copyBtn = document.createElement('button');
    copyBtn.textContent = 'Copy';
    copyBtn.onclick = () => {
        navigator.clipboard.writeText(total.toString());
   alert('Permission integer copied to clipboard!');
    };
    
    if (!result.nextElementSibling || result.nextElementSibling.tagName !== 'BUTTON') {
   result.parentNode.appendChild(copyBtn);
    }
}

// JSON Formatter utility
function formatJSON() {
    const input = document.getElementById('json-input').value;
    const output = document.getElementById('json-output');
    
try {
      const parsed = JSON.parse(input);
        output.value = JSON.stringify(parsed, null, 2);
     output.classList.remove('error');
    } catch (e) {
        output.value = 'Invalid JSON: ' + e.message;
        output.classList.add('error');
    }
}

// Initialize the first section as visible
document.addEventListener('DOMContentLoaded', () => {
    showSection('bot-testing');
});